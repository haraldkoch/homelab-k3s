rules:
  - name: "docker.io rewrite rule"
    matches:
      - "^docker.io"
    excludes:
      # solve the chicken / egg problem?
      - "goharbor/"
    replace: "harbor.harbor.svc.cluster.local:80/dockerhub_proxy"
    checkUpstream: true
  - name: "quay.io rewrite rule"
    matches:
      - "^quay.io"
    excludes: []
    replace: "harbor.harbor.svc.cluster.local:80/quay_proxy"
    checkUpstream: true
  - name: "ghcr.io rewrite rule"
    matches:
      - "^ghcr.io"
    excludes: []
    # replace: "harbor.harbor.svc.cluster.local:80/ghcr_proxy"
    replace: "image-cache-ghcr-docker-registry.system.svc.cluster.local:5020"
    checkUpstream: true

podAnnotations:
  configmap.reloader.stakater.com/reload: "harbor-container-webhook"

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/arch
              operator: In
              values:
                - "amd64"

tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
  # Still need this for compatability
  - key: "node-role.kubernetes.io/master"
    operator: "Exists"
